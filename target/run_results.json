{"logs": [], "results": [{"node": {"raw_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from {{ source('datamart', 'dim_opportunity') }}\n\n),\n\nremaned_src as (\n\n    select\n        id,\n        partner_id,\n        country_code_iso3,\n        finished_date,\n        first_appointment_date,\n        partner_service_premium,\n        days_to_first_appointment,\n        stage_name,\n        created_date,\n        gross_process_duration,\n        nav_number_of_hearing_aids,\n        nav_revenue_local\n\n    from src\n\n)\n\nselect * from remaned_src", "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "staging", "datamart", "stg_dim_opportunity"], "unique_id": "model.partner_portal.stg_dim_opportunity", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "staging/datamart/stg_dim_opportunity.sql", "original_file_path": "models/staging/datamart/stg_dim_opportunity.sql", "name": "stg_dim_opportunity", "resource_type": "model", "alias": "stg_dim_opportunity", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "transient": true}, "tags": [], "refs": [], "sources": [["datamart", "dim_opportunity"]], "depends_on": {"macros": [], "nodes": ["source.partner_portal.datamart.dim_opportunity"]}, "description": "", "columns": {"id": {"name": "id", "description": "", "meta": {}, "data_type": null, "tags": []}, "partner_id": {"name": "partner_id", "description": "", "meta": {}, "data_type": null, "tags": []}, "country_code_iso3": {"name": "country_code_iso3", "description": "", "meta": {}, "data_type": null, "tags": []}, "finished_date": {"name": "finished_date", "description": "", "meta": {}, "data_type": null, "tags": []}, "first_appointment_date": {"name": "first_appointment_date", "description": "", "meta": {}, "data_type": null, "tags": []}, "partner_service_premium": {"name": "partner_service_premium", "description": "", "meta": {}, "data_type": null, "tags": []}, "days_to_first_appointment": {"name": "days_to_first_appointment", "description": "", "meta": {}, "data_type": null, "tags": []}}, "meta": {}, "docs": {"show": true}, "patch_path": "models/staging/datamart/stg_datamart.yml", "build_path": "target/compiled/partner_portal/models/staging/datamart/stg_dim_opportunity.sql", "compiled": true, "compiled_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from partner_portal.datamart.dim_opportunity\n\n),\n\nremaned_src as (\n\n    select\n        id,\n        partner_id,\n        country_code_iso3,\n        finished_date,\n        first_appointment_date,\n        partner_service_premium,\n        days_to_first_appointment,\n        stage_name,\n        created_date,\n        gross_process_duration,\n        nav_number_of_hearing_aids,\n        nav_revenue_local\n\n    from src\n\n)\n\nselect * from remaned_src", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from partner_portal.datamart.dim_opportunity\n\n),\n\nremaned_src as (\n\n    select\n        id,\n        partner_id,\n        country_code_iso3,\n        finished_date,\n        first_appointment_date,\n        partner_service_premium,\n        days_to_first_appointment,\n        stage_name,\n        created_date,\n        gross_process_duration,\n        nav_number_of_hearing_aids,\n        nav_revenue_local\n\n    from src\n\n)\n\nselect * from remaned_src"}, "error": null, "status": null, "execution_time": 0.056348323822021484, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:06.820772Z", "completed_at": "2020-10-11T11:00:06.876163Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:06.876624Z", "completed_at": "2020-10-11T11:00:06.876640Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from {{ source('datamart', 'dim_partner_subsidiary') }}\n\n),\n\nremaned_src as (\n\n    select\n        id as id,\n        parent_id\n\n    from src\n\n)\n\nselect * from remaned_src", "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "staging", "datamart", "stg_dim_partner_subsidiary"], "unique_id": "model.partner_portal.stg_dim_partner_subsidiary", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "staging/datamart/stg_dim_partner_subsidiary.sql", "original_file_path": "models/staging/datamart/stg_dim_partner_subsidiary.sql", "name": "stg_dim_partner_subsidiary", "resource_type": "model", "alias": "stg_dim_partner_subsidiary", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "transient": true}, "tags": [], "refs": [], "sources": [["datamart", "dim_partner_subsidiary"]], "depends_on": {"macros": [], "nodes": ["source.partner_portal.datamart.dim_partner_subsidiary"]}, "description": "", "columns": {"id": {"name": "id", "description": "", "meta": {}, "data_type": null, "tags": []}, "parent_id": {"name": "parent_id", "description": "", "meta": {}, "data_type": null, "tags": []}}, "meta": {}, "docs": {"show": true}, "patch_path": "models/staging/datamart/stg_datamart.yml", "build_path": "target/compiled/partner_portal/models/staging/datamart/stg_dim_partner_subsidiary.sql", "compiled": true, "compiled_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from partner_portal.datamart.dim_partner_subsidiary\n\n),\n\nremaned_src as (\n\n    select\n        id as id,\n        parent_id\n\n    from src\n\n)\n\nselect * from remaned_src", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from partner_portal.datamart.dim_partner_subsidiary\n\n),\n\nremaned_src as (\n\n    select\n        id as id,\n        parent_id\n\n    from src\n\n)\n\nselect * from remaned_src"}, "error": null, "status": null, "execution_time": 0.029873371124267578, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:06.877304Z", "completed_at": "2020-10-11T11:00:06.906114Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:06.906702Z", "completed_at": "2020-10-11T11:00:06.906723Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from {{ source('stg_finance', 'navision_item') }}\n\n),\n\nremaned_src as (\n\n    select\n        no_\n        ,country_code_iso3\n        ,item_category_code\n        ,manufacturer_code\n\n    from src\n\n)\n\nselect * from remaned_src", "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "staging", "stg_finance", "stg_navision_item"], "unique_id": "model.partner_portal.stg_navision_item", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "staging/stg_finance/stg_navision_item.sql", "original_file_path": "models/staging/stg_finance/stg_navision_item.sql", "name": "stg_navision_item", "resource_type": "model", "alias": "stg_navision_item", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "transient": true}, "tags": [], "refs": [], "sources": [["stg_finance", "navision_item"]], "depends_on": {"macros": [], "nodes": ["source.partner_portal.stg_finance.navision_item"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/staging/stg_finance/stg_navision_item.sql", "compiled": true, "compiled_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from partner_portal.stg_finance.navision_item\n\n),\n\nremaned_src as (\n\n    select\n        no_\n        ,country_code_iso3\n        ,item_category_code\n        ,manufacturer_code\n\n    from src\n\n)\n\nselect * from remaned_src", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from partner_portal.stg_finance.navision_item\n\n),\n\nremaned_src as (\n\n    select\n        no_\n        ,country_code_iso3\n        ,item_category_code\n        ,manufacturer_code\n\n    from src\n\n)\n\nselect * from remaned_src"}, "error": null, "status": null, "execution_time": 0.030555248260498047, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:06.907564Z", "completed_at": "2020-10-11T11:00:06.936903Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:06.937447Z", "completed_at": "2020-10-11T11:00:06.937461Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from {{ source('stg_finance', 'navision_manufacturer') }}\n\n),\n\nremaned_src as (\n\n    select\n        name\n        ,country_code_iso3\n        ,code\n\n    from src\n\n)\n\nselect * from remaned_src", "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "staging", "stg_finance", "stg_navision_manufacturer"], "unique_id": "model.partner_portal.stg_navision_manufacturer", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "staging/stg_finance/stg_navision_manufacturer.sql", "original_file_path": "models/staging/stg_finance/stg_navision_manufacturer.sql", "name": "stg_navision_manufacturer", "resource_type": "model", "alias": "stg_navision_manufacturer", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "transient": true}, "tags": [], "refs": [], "sources": [["stg_finance", "navision_manufacturer"]], "depends_on": {"macros": [], "nodes": ["source.partner_portal.stg_finance.navision_manufacturer"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/staging/stg_finance/stg_navision_manufacturer.sql", "compiled": true, "compiled_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from partner_portal.stg_finance.navision_manufacturer\n\n),\n\nremaned_src as (\n\n    select\n        name\n        ,country_code_iso3\n        ,code\n\n    from src\n\n)\n\nselect * from remaned_src", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from partner_portal.stg_finance.navision_manufacturer\n\n),\n\nremaned_src as (\n\n    select\n        name\n        ,country_code_iso3\n        ,code\n\n    from src\n\n)\n\nselect * from remaned_src"}, "error": null, "status": null, "execution_time": 0.03228187561035156, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:06.938425Z", "completed_at": "2020-10-11T11:00:06.969497Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:06.970103Z", "completed_at": "2020-10-11T11:00:06.970117Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from {{ source('stg_finance', 'navision_sp_fitting_header') }}\n\n),\n\nremaned_src as (\n\n    select\n        country_code_iso3\n        ,salesforce_id\n        ,no_\n\n    from src\n\n)\n\nselect * from remaned_src", "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "staging", "stg_finance", "stg_navision_sp_fitting_header"], "unique_id": "model.partner_portal.stg_navision_sp_fitting_header", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "staging/stg_finance/stg_navision_sp_fitting_header.sql", "original_file_path": "models/staging/stg_finance/stg_navision_sp_fitting_header.sql", "name": "stg_navision_sp_fitting_header", "resource_type": "model", "alias": "stg_navision_sp_fitting_header", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "transient": true}, "tags": [], "refs": [], "sources": [["stg_finance", "navision_sp_fitting_header"]], "depends_on": {"macros": [], "nodes": ["source.partner_portal.stg_finance.navision_sp_fitting_header"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/staging/stg_finance/stg_navision_sp_fitting_header.sql", "compiled": true, "compiled_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from partner_portal.stg_finance.navision_sp_fitting_header\n\n),\n\nremaned_src as (\n\n    select\n        country_code_iso3\n        ,salesforce_id\n        ,no_\n\n    from src\n\n)\n\nselect * from remaned_src", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from partner_portal.stg_finance.navision_sp_fitting_header\n\n),\n\nremaned_src as (\n\n    select\n        country_code_iso3\n        ,salesforce_id\n        ,no_\n\n    from src\n\n)\n\nselect * from remaned_src"}, "error": null, "status": null, "execution_time": 0.03382396697998047, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:06.971068Z", "completed_at": "2020-10-11T11:00:07.003981Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.004416Z", "completed_at": "2020-10-11T11:00:07.004428Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from {{ source('stg_finance', 'navision_sp_fitting_line') }}\n\n),\n\nremaned_src as (\n\n    select\n        fitting_process_no_\n        ,no_\n        ,country_code_iso3\n    from src\n\n)\n\nselect * from remaned_src", "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "staging", "stg_finance", "stg_navision_sp_fitting_line"], "unique_id": "model.partner_portal.stg_navision_sp_fitting_line", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "staging/stg_finance/stg_navision_sp_fitting_line.sql", "original_file_path": "models/staging/stg_finance/stg_navision_sp_fitting_line.sql", "name": "stg_navision_sp_fitting_line", "resource_type": "model", "alias": "stg_navision_sp_fitting_line", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "transient": true}, "tags": [], "refs": [], "sources": [["stg_finance", "navision_sp_fitting_line"]], "depends_on": {"macros": [], "nodes": ["source.partner_portal.stg_finance.navision_sp_fitting_line"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/staging/stg_finance/stg_navision_sp_fitting_line.sql", "compiled": true, "compiled_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from partner_portal.stg_finance.navision_sp_fitting_line\n\n),\n\nremaned_src as (\n\n    select\n        fitting_process_no_\n        ,no_\n        ,country_code_iso3\n    from src\n\n)\n\nselect * from remaned_src", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from partner_portal.stg_finance.navision_sp_fitting_line\n\n),\n\nremaned_src as (\n\n    select\n        fitting_process_no_\n        ,no_\n        ,country_code_iso3\n    from src\n\n)\n\nselect * from remaned_src"}, "error": null, "status": null, "execution_time": 0.031417131423950195, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:07.005065Z", "completed_at": "2020-10-11T11:00:07.035687Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.036089Z", "completed_at": "2020-10-11T11:00:07.036099Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from {{ source('ext_sales', 'salesforce_quote') }}\n\n),\n\nremaned_src as (\n\n    select\n        opportunityid,\n        createddate,\n        buying_type__c,\n        status,\n        id,\n        total_discount__c,\n        HEARING_AID_RIGHT__C,\n        HEARING_AID_LEFT__C,\n--        datetime,\n        selected_hearing_aid__c,\n        first_appointment_confirmed__c\n\n    from src\n\n)\n\nselect * from remaned_src", "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "staging", "ext_sales", "stg_salesforce_quote"], "unique_id": "model.partner_portal.stg_salesforce_quote", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "staging/ext_sales/stg_salesforce_quote.sql", "original_file_path": "models/staging/ext_sales/stg_salesforce_quote.sql", "name": "stg_salesforce_quote", "resource_type": "model", "alias": "stg_salesforce_quote", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "transient": true}, "tags": [], "refs": [], "sources": [["ext_sales", "salesforce_quote"]], "depends_on": {"macros": [], "nodes": ["source.partner_portal.ext_sales.salesforce_quote"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/staging/ext_sales/stg_salesforce_quote.sql", "compiled": true, "compiled_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from partner_portal.ext_sales.salesforce_quote\n\n),\n\nremaned_src as (\n\n    select\n        opportunityid,\n        createddate,\n        buying_type__c,\n        status,\n        id,\n        total_discount__c,\n        HEARING_AID_RIGHT__C,\n        HEARING_AID_LEFT__C,\n--        datetime,\n        selected_hearing_aid__c,\n        first_appointment_confirmed__c\n\n    from src\n\n)\n\nselect * from remaned_src", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from partner_portal.ext_sales.salesforce_quote\n\n),\n\nremaned_src as (\n\n    select\n        opportunityid,\n        createddate,\n        buying_type__c,\n        status,\n        id,\n        total_discount__c,\n        HEARING_AID_RIGHT__C,\n        HEARING_AID_LEFT__C,\n--        datetime,\n        selected_hearing_aid__c,\n        first_appointment_confirmed__c\n\n    from src\n\n)\n\nselect * from remaned_src"}, "error": null, "status": null, "execution_time": 0.030576467514038086, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:07.036719Z", "completed_at": "2020-10-11T11:00:07.066453Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.066891Z", "completed_at": "2020-10-11T11:00:07.066901Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from {{ source('ext_sales', 'salesforce_account') }}\n\n),\n\nremaned_src as (\n\n    select\n        id,\n        parentid,\n        dw_modified_at,\n        billingpostalcode\n\n    from src\n\n)\n\nselect * from remaned_src", "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "staging", "ext_sales", "stg_salesforce_account"], "unique_id": "model.partner_portal.stg_salesforce_account", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "staging/ext_sales/stg_salesforce_account.sql", "original_file_path": "models/staging/ext_sales/stg_salesforce_account.sql", "name": "stg_salesforce_account", "resource_type": "model", "alias": "stg_salesforce_account", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "transient": true}, "tags": [], "refs": [], "sources": [["ext_sales", "salesforce_account"]], "depends_on": {"macros": [], "nodes": ["source.partner_portal.ext_sales.salesforce_account"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/staging/ext_sales/stg_salesforce_account.sql", "compiled": true, "compiled_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from partner_portal.ext_sales.salesforce_account\n\n),\n\nremaned_src as (\n\n    select\n        id,\n        parentid,\n        dw_modified_at,\n        billingpostalcode\n\n    from src\n\n)\n\nselect * from remaned_src", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from partner_portal.ext_sales.salesforce_account\n\n),\n\nremaned_src as (\n\n    select\n        id,\n        parentid,\n        dw_modified_at,\n        billingpostalcode\n\n    from src\n\n)\n\nselect * from remaned_src"}, "error": null, "status": null, "execution_time": 0.028259992599487305, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:07.067522Z", "completed_at": "2020-10-11T11:00:07.095003Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.095391Z", "completed_at": "2020-10-11T11:00:07.095401Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from {{ source('ext_sales', 'salesforce_lead') }}\n\n),\n\nremaned_src as (\n\n    select\n        id,\n        convertedopportunityid,\n        dw_modified_at\n\n    from src\n\n)\n\nselect * from remaned_src", "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "staging", "ext_sales", "stg_salesforce_lead"], "unique_id": "model.partner_portal.stg_salesforce_lead", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "staging/ext_sales/stg_salesforce_lead.sql", "original_file_path": "models/staging/ext_sales/stg_salesforce_lead.sql", "name": "stg_salesforce_lead", "resource_type": "model", "alias": "stg_salesforce_lead", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "transient": true}, "tags": [], "refs": [], "sources": [["ext_sales", "salesforce_lead"]], "depends_on": {"macros": [], "nodes": ["source.partner_portal.ext_sales.salesforce_lead"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/staging/ext_sales/stg_salesforce_lead.sql", "compiled": true, "compiled_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from partner_portal.ext_sales.salesforce_lead\n\n),\n\nremaned_src as (\n\n    select\n        id,\n        convertedopportunityid,\n        dw_modified_at\n\n    from src\n\n)\n\nselect * from remaned_src", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from partner_portal.ext_sales.salesforce_lead\n\n),\n\nremaned_src as (\n\n    select\n        id,\n        convertedopportunityid,\n        dw_modified_at\n\n    from src\n\n)\n\nselect * from remaned_src"}, "error": null, "status": null, "execution_time": 0.02770066261291504, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:07.096006Z", "completed_at": "2020-10-11T11:00:07.122932Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.123318Z", "completed_at": "2020-10-11T11:00:07.123328Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from {{ source('ext_sales', 'salesforce_opportunity') }}\n\n),\n\nremaned_src as (\n\n    select\n        createddate,\n        id,\n        ISO_COUNTRY_CODE_CUSTOMER__C,\n        pak_partnerid__c,\n        ab_helper_first_appointment__c,\n        partner_service_premium__c,\n        time_to_first_appointment__c,\n        accountid,\n        dw_modified_at\n\n    from src\n\n)\n\nselect * from remaned_src", "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "staging", "ext_sales", "stg_salesforce_opportunity"], "unique_id": "model.partner_portal.stg_salesforce_opportunity", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "staging/ext_sales/stg_salesforce_opportunity.sql", "original_file_path": "models/staging/ext_sales/stg_salesforce_opportunity.sql", "name": "stg_salesforce_opportunity", "resource_type": "model", "alias": "stg_salesforce_opportunity", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "transient": true}, "tags": [], "refs": [], "sources": [["ext_sales", "salesforce_opportunity"]], "depends_on": {"macros": [], "nodes": ["source.partner_portal.ext_sales.salesforce_opportunity"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/staging/ext_sales/stg_salesforce_opportunity.sql", "compiled": true, "compiled_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from partner_portal.ext_sales.salesforce_opportunity\n\n),\n\nremaned_src as (\n\n    select\n        createddate,\n        id,\n        ISO_COUNTRY_CODE_CUSTOMER__C,\n        pak_partnerid__c,\n        ab_helper_first_appointment__c,\n        partner_service_premium__c,\n        time_to_first_appointment__c,\n        accountid,\n        dw_modified_at\n\n    from src\n\n)\n\nselect * from remaned_src", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from partner_portal.ext_sales.salesforce_opportunity\n\n),\n\nremaned_src as (\n\n    select\n        createddate,\n        id,\n        ISO_COUNTRY_CODE_CUSTOMER__C,\n        pak_partnerid__c,\n        ab_helper_first_appointment__c,\n        partner_service_premium__c,\n        time_to_first_appointment__c,\n        accountid,\n        dw_modified_at\n\n    from src\n\n)\n\nselect * from remaned_src"}, "error": null, "status": null, "execution_time": 0.030793190002441406, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:07.123936Z", "completed_at": "2020-10-11T11:00:07.153693Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.154213Z", "completed_at": "2020-10-11T11:00:07.154227Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from {{ source('ext_sales', 'salesforce_task') }}\n\n),\n\nremaned_src as (\n\n    select\n        opportunity__c,\n        worth_recognized__c\n\n    from src\n\n)\n\nselect * from remaned_src", "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "staging", "ext_sales", "stg_salesforce_task"], "unique_id": "model.partner_portal.stg_salesforce_task", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "staging/ext_sales/stg_salesforce_task.sql", "original_file_path": "models/staging/ext_sales/stg_salesforce_task.sql", "name": "stg_salesforce_task", "resource_type": "model", "alias": "stg_salesforce_task", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "transient": true}, "tags": [], "refs": [], "sources": [["ext_sales", "salesforce_task"]], "depends_on": {"macros": [], "nodes": ["source.partner_portal.ext_sales.salesforce_task"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/staging/ext_sales/stg_salesforce_task.sql", "compiled": true, "compiled_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from partner_portal.ext_sales.salesforce_task\n\n),\n\nremaned_src as (\n\n    select\n        opportunity__c,\n        worth_recognized__c\n\n    from src\n\n)\n\nselect * from remaned_src", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "-- source has syntax Source {'schema_name','table_name'}\nwith src as (\n\n    select * from partner_portal.ext_sales.salesforce_task\n\n),\n\nremaned_src as (\n\n    select\n        opportunity__c,\n        worth_recognized__c\n\n    from src\n\n)\n\nselect * from remaned_src"}, "error": null, "status": null, "execution_time": 0.029543161392211914, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:07.155104Z", "completed_at": "2020-10-11T11:00:07.183692Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.184044Z", "completed_at": "2020-10-11T11:00:07.184056Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "{{ config(severity='WARN') }}{{ test_accepted_values(**_dbt_schema_test_kwargs) }}", "test_metadata": {"namespace": null, "name": "accepted_values", "kwargs": {"values": ["CAN", "CHE", "CHN", "DEU", "FRA", "GBR", "HKG", "IND", "JPN", "KOR", "MYS", "N/A", "NLD", "SGP", "THA", "USA", "ZAF'"], "column_name": "country_code_iso3", "model": "{{ source('datamart', 'dim_opportunity') }}"}}, "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "schema_test", "source_accepted_values_datamart_dim_opportunity_country_code_iso3__CAN__CHE__CHN__DEU__FRA__GBR__HKG__IND__JPN__KOR__MYS__N_A__NLD__SGP__THA__USA__ZAF_"], "unique_id": "test.partner_portal.source_accepted_values_datamart_dim_opportunity_country_code_iso3__CAN__CHE__CHN__DEU__FRA__GBR__HKG__IND__JPN__KOR__MYS__N_A__NLD__SGP__THA__USA__ZAF_", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "schema_test/source_accepted_values_datamart_dim_opportunity_777efc2848f4a78747608c876e2973b6.sql", "original_file_path": "models/staging/datamart/src_datamart.yml", "name": "source_accepted_values_datamart_dim_opportunity_country_code_iso3__CAN__CHE__CHN__DEU__FRA__GBR__HKG__IND__JPN__KOR__MYS__N_A__NLD__SGP__THA__USA__ZAF_", "resource_type": "test", "alias": "source_accepted_values_datamart_dim_opportunity_country_code_iso3__CAN__CHE__CHN__DEU__FRA__GBR__HKG__IND__JPN__KOR__MYS__N_A__NLD__SGP__THA__USA__ZAF_", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "severity": "WARN", "transient": true}, "tags": ["schema"], "refs": [], "sources": [["datamart", "dim_opportunity"]], "depends_on": {"macros": ["macro.dbt.test_accepted_values"], "nodes": ["source.partner_portal.datamart.dim_opportunity"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/staging/datamart/src_datamart.yml/schema_test/source_accepted_values_datamart_dim_opportunity_777efc2848f4a78747608c876e2973b6.sql", "compiled": true, "compiled_sql": "\n\n\n\n\nwith all_values as (\n\n    select distinct\n        country_code_iso3 as value_field\n\n    from partner_portal.datamart.dim_opportunity\n\n),\n\nvalidation_errors as (\n\n    select\n        value_field\n\n    from all_values\n    where value_field not in (\n        'CAN','CHE','CHN','DEU','FRA','GBR','HKG','IND','JPN','KOR','MYS','N/A','NLD','SGP','THA','USA','ZAF''\n    )\n)\n\nselect count(*) as validation_errors\nfrom validation_errors\n\n", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "\n\n\n\n\nwith all_values as (\n\n    select distinct\n        country_code_iso3 as value_field\n\n    from partner_portal.datamart.dim_opportunity\n\n),\n\nvalidation_errors as (\n\n    select\n        value_field\n\n    from all_values\n    where value_field not in (\n        'CAN','CHE','CHN','DEU','FRA','GBR','HKG','IND','JPN','KOR','MYS','N/A','NLD','SGP','THA','USA','ZAF''\n    )\n)\n\nselect count(*) as validation_errors\nfrom validation_errors\n\n", "column_name": "country_code_iso3"}, "error": null, "status": null, "execution_time": 0.053281545639038086, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:07.185049Z", "completed_at": "2020-10-11T11:00:07.237433Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.237839Z", "completed_at": "2020-10-11T11:00:07.237851Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "{{ config(severity='WARN') }}{{ test_accepted_values(**_dbt_schema_test_kwargs) }}", "test_metadata": {"namespace": null, "name": "accepted_values", "kwargs": {"values": ["CAN", "CHE", "CHN", "DEU", "FRA", "GBR", "HKG", "IND", "JPN", "KOR", "MYS", "N/A", "NLD", "SGP", "THA", "USA", "ZAF'"], "column_name": "country_code_iso3", "model": "{{ source('stg_finance', 'navision_sp_fitting_header') }}"}}, "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "schema_test", "source_accepted_values_stg_finance_navision_sp_fitting_header_country_code_iso3__CAN__CHE__CHN__DEU__FRA__GBR__HKG__IND__JPN__KOR__MYS__N_A__NLD__SGP__THA__USA__ZAF_"], "unique_id": "test.partner_portal.source_accepted_values_stg_finance_navision_sp_fitting_header_country_code_iso3__CAN__CHE__CHN__DEU__FRA__GBR__HKG__IND__JPN__KOR__MYS__N_A__NLD__SGP__THA__USA__ZAF_", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "schema_test/source_accepted_values_stg_finance_navision_sp_fitting_header_777efc2848f4a78747608c876e2973b6.sql", "original_file_path": "models/staging/stg_finance/src_stg_finance.yml", "name": "source_accepted_values_stg_finance_navision_sp_fitting_header_country_code_iso3__CAN__CHE__CHN__DEU__FRA__GBR__HKG__IND__JPN__KOR__MYS__N_A__NLD__SGP__THA__USA__ZAF_", "resource_type": "test", "alias": "source_accepted_values_stg_finance_navision_sp_fitting_header_country_code_iso3__CAN__CHE__CHN__DEU__FRA__GBR__HKG__IND__JPN__KOR__MYS__N_A__NLD__SGP__THA__USA__ZAF_", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "severity": "WARN", "transient": true}, "tags": ["schema"], "refs": [], "sources": [["stg_finance", "navision_sp_fitting_header"]], "depends_on": {"macros": ["macro.dbt.test_accepted_values"], "nodes": ["source.partner_portal.stg_finance.navision_sp_fitting_header"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/staging/stg_finance/src_stg_finance.yml/schema_test/source_accepted_values_stg_finance_navision_sp_fitting_header_777efc2848f4a78747608c876e2973b6.sql", "compiled": true, "compiled_sql": "\n\n\n\n\nwith all_values as (\n\n    select distinct\n        country_code_iso3 as value_field\n\n    from partner_portal.stg_finance.navision_sp_fitting_header\n\n),\n\nvalidation_errors as (\n\n    select\n        value_field\n\n    from all_values\n    where value_field not in (\n        'CAN','CHE','CHN','DEU','FRA','GBR','HKG','IND','JPN','KOR','MYS','N/A','NLD','SGP','THA','USA','ZAF''\n    )\n)\n\nselect count(*) as validation_errors\nfrom validation_errors\n\n", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "\n\n\n\n\nwith all_values as (\n\n    select distinct\n        country_code_iso3 as value_field\n\n    from partner_portal.stg_finance.navision_sp_fitting_header\n\n),\n\nvalidation_errors as (\n\n    select\n        value_field\n\n    from all_values\n    where value_field not in (\n        'CAN','CHE','CHN','DEU','FRA','GBR','HKG','IND','JPN','KOR','MYS','N/A','NLD','SGP','THA','USA','ZAF''\n    )\n)\n\nselect count(*) as validation_errors\nfrom validation_errors\n\n", "column_name": "country_code_iso3"}, "error": null, "status": null, "execution_time": 0.037192583084106445, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:07.238468Z", "completed_at": "2020-10-11T11:00:07.274831Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.275258Z", "completed_at": "2020-10-11T11:00:07.275269Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "{{ config(severity='WARN') }}{{ test_not_null(**_dbt_schema_test_kwargs) }}", "test_metadata": {"namespace": null, "name": "not_null", "kwargs": {"column_name": "id", "model": "{{ source('datamart', 'dim_opportunity') }}"}}, "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "schema_test", "source_not_null_datamart_dim_opportunity_id"], "unique_id": "test.partner_portal.source_not_null_datamart_dim_opportunity_id", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "schema_test/source_not_null_datamart_dim_opportunity_id.sql", "original_file_path": "models/staging/datamart/src_datamart.yml", "name": "source_not_null_datamart_dim_opportunity_id", "resource_type": "test", "alias": "source_not_null_datamart_dim_opportunity_id", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "severity": "WARN", "transient": true}, "tags": ["schema"], "refs": [], "sources": [["datamart", "dim_opportunity"]], "depends_on": {"macros": ["macro.dbt.test_not_null"], "nodes": ["source.partner_portal.datamart.dim_opportunity"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/staging/datamart/src_datamart.yml/schema_test/source_not_null_datamart_dim_opportunity_id.sql", "compiled": true, "compiled_sql": "\n\n\n\nselect count(*) as validation_errors\nfrom partner_portal.datamart.dim_opportunity\nwhere id is null\n\n", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "\n\n\n\nselect count(*) as validation_errors\nfrom partner_portal.datamart.dim_opportunity\nwhere id is null\n\n", "column_name": "id"}, "error": null, "status": null, "execution_time": 0.03233170509338379, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:07.275903Z", "completed_at": "2020-10-11T11:00:07.307471Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.307835Z", "completed_at": "2020-10-11T11:00:07.307846Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "{{ config(severity='WARN') }}{{ test_not_null(**_dbt_schema_test_kwargs) }}", "test_metadata": {"namespace": null, "name": "not_null", "kwargs": {"column_name": "id", "model": "{{ source('datamart', 'dim_partner_subsidiary') }}"}}, "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "schema_test", "source_not_null_datamart_dim_partner_subsidiary_id"], "unique_id": "test.partner_portal.source_not_null_datamart_dim_partner_subsidiary_id", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "schema_test/source_not_null_datamart_dim_partner_subsidiary_id.sql", "original_file_path": "models/staging/datamart/src_datamart.yml", "name": "source_not_null_datamart_dim_partner_subsidiary_id", "resource_type": "test", "alias": "source_not_null_datamart_dim_partner_subsidiary_id", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "severity": "WARN", "transient": true}, "tags": ["schema"], "refs": [], "sources": [["datamart", "dim_partner_subsidiary"]], "depends_on": {"macros": ["macro.dbt.test_not_null"], "nodes": ["source.partner_portal.datamart.dim_partner_subsidiary"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/staging/datamart/src_datamart.yml/schema_test/source_not_null_datamart_dim_partner_subsidiary_id.sql", "compiled": true, "compiled_sql": "\n\n\n\nselect count(*) as validation_errors\nfrom partner_portal.datamart.dim_partner_subsidiary\nwhere id is null\n\n", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "\n\n\n\nselect count(*) as validation_errors\nfrom partner_portal.datamart.dim_partner_subsidiary\nwhere id is null\n\n", "column_name": "id"}, "error": null, "status": null, "execution_time": 0.030443906784057617, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:07.308453Z", "completed_at": "2020-10-11T11:00:07.338061Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.338502Z", "completed_at": "2020-10-11T11:00:07.338512Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "{{ config(severity='WARN') }}{{ test_not_null(**_dbt_schema_test_kwargs) }}", "test_metadata": {"namespace": null, "name": "not_null", "kwargs": {"column_name": "salesforce_id", "model": "{{ source('stg_finance', 'navision_sp_fitting_header') }}"}}, "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "schema_test", "source_not_null_stg_finance_navision_sp_fitting_header_salesforce_id"], "unique_id": "test.partner_portal.source_not_null_stg_finance_navision_sp_fitting_header_salesforce_id", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "schema_test/source_not_null_stg_finance_navision_sp_fitting_header_salesforce_id.sql", "original_file_path": "models/staging/stg_finance/src_stg_finance.yml", "name": "source_not_null_stg_finance_navision_sp_fitting_header_salesforce_id", "resource_type": "test", "alias": "source_not_null_stg_finance_navision_sp_fitting_header_salesforce_id", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "severity": "WARN", "transient": true}, "tags": ["schema"], "refs": [], "sources": [["stg_finance", "navision_sp_fitting_header"]], "depends_on": {"macros": ["macro.dbt.test_not_null"], "nodes": ["source.partner_portal.stg_finance.navision_sp_fitting_header"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/staging/stg_finance/src_stg_finance.yml/schema_test/source_not_null_stg_finance_navision_sp_fitting_header_salesforce_id.sql", "compiled": true, "compiled_sql": "\n\n\n\nselect count(*) as validation_errors\nfrom partner_portal.stg_finance.navision_sp_fitting_header\nwhere salesforce_id is null\n\n", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "\n\n\n\nselect count(*) as validation_errors\nfrom partner_portal.stg_finance.navision_sp_fitting_header\nwhere salesforce_id is null\n\n", "column_name": "salesforce_id"}, "error": null, "status": null, "execution_time": 0.029087305068969727, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:07.339133Z", "completed_at": "2020-10-11T11:00:07.367401Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.367825Z", "completed_at": "2020-10-11T11:00:07.367835Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "{{ config(severity='WARN') }}{{ test_unique(**_dbt_schema_test_kwargs) }}", "test_metadata": {"namespace": null, "name": "unique", "kwargs": {"column_name": "id", "model": "{{ source('datamart', 'dim_opportunity') }}"}}, "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "schema_test", "source_unique_datamart_dim_opportunity_id"], "unique_id": "test.partner_portal.source_unique_datamart_dim_opportunity_id", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "schema_test/source_unique_datamart_dim_opportunity_id.sql", "original_file_path": "models/staging/datamart/src_datamart.yml", "name": "source_unique_datamart_dim_opportunity_id", "resource_type": "test", "alias": "source_unique_datamart_dim_opportunity_id", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "severity": "WARN", "transient": true}, "tags": ["schema"], "refs": [], "sources": [["datamart", "dim_opportunity"]], "depends_on": {"macros": ["macro.dbt.test_unique"], "nodes": ["source.partner_portal.datamart.dim_opportunity"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/staging/datamart/src_datamart.yml/schema_test/source_unique_datamart_dim_opportunity_id.sql", "compiled": true, "compiled_sql": "\n\n\n\nselect count(*) as validation_errors\nfrom (\n\n    select\n        id\n\n    from partner_portal.datamart.dim_opportunity\n    where id is not null\n    group by id\n    having count(*) > 1\n\n) validation_errors\n\n", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "\n\n\n\nselect count(*) as validation_errors\nfrom (\n\n    select\n        id\n\n    from partner_portal.datamart.dim_opportunity\n    where id is not null\n    group by id\n    having count(*) > 1\n\n) validation_errors\n\n", "column_name": "id"}, "error": null, "status": null, "execution_time": 0.031003475189208984, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:07.368457Z", "completed_at": "2020-10-11T11:00:07.398656Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.399064Z", "completed_at": "2020-10-11T11:00:07.399075Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "{{ config(severity='WARN') }}{{ test_unique(**_dbt_schema_test_kwargs) }}", "test_metadata": {"namespace": null, "name": "unique", "kwargs": {"column_name": "id", "model": "{{ source('datamart', 'dim_partner_subsidiary') }}"}}, "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "schema_test", "source_unique_datamart_dim_partner_subsidiary_id"], "unique_id": "test.partner_portal.source_unique_datamart_dim_partner_subsidiary_id", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "schema_test/source_unique_datamart_dim_partner_subsidiary_id.sql", "original_file_path": "models/staging/datamart/src_datamart.yml", "name": "source_unique_datamart_dim_partner_subsidiary_id", "resource_type": "test", "alias": "source_unique_datamart_dim_partner_subsidiary_id", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "severity": "WARN", "transient": true}, "tags": ["schema"], "refs": [], "sources": [["datamart", "dim_partner_subsidiary"]], "depends_on": {"macros": ["macro.dbt.test_unique"], "nodes": ["source.partner_portal.datamart.dim_partner_subsidiary"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/staging/datamart/src_datamart.yml/schema_test/source_unique_datamart_dim_partner_subsidiary_id.sql", "compiled": true, "compiled_sql": "\n\n\n\nselect count(*) as validation_errors\nfrom (\n\n    select\n        id\n\n    from partner_portal.datamart.dim_partner_subsidiary\n    where id is not null\n    group by id\n    having count(*) > 1\n\n) validation_errors\n\n", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "\n\n\n\nselect count(*) as validation_errors\nfrom (\n\n    select\n        id\n\n    from partner_portal.datamart.dim_partner_subsidiary\n    where id is not null\n    group by id\n    having count(*) > 1\n\n) validation_errors\n\n", "column_name": "id"}, "error": null, "status": null, "execution_time": 0.03164529800415039, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:07.399685Z", "completed_at": "2020-10-11T11:00:07.430273Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.430794Z", "completed_at": "2020-10-11T11:00:07.430809Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "{{ config(severity='WARN') }}{{ test_unique(**_dbt_schema_test_kwargs) }}", "test_metadata": {"namespace": null, "name": "unique", "kwargs": {"column_name": "salesforce_id", "model": "{{ source('stg_finance', 'navision_sp_fitting_header') }}"}}, "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "schema_test", "source_unique_stg_finance_navision_sp_fitting_header_salesforce_id"], "unique_id": "test.partner_portal.source_unique_stg_finance_navision_sp_fitting_header_salesforce_id", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "schema_test/source_unique_stg_finance_navision_sp_fitting_header_salesforce_id.sql", "original_file_path": "models/staging/stg_finance/src_stg_finance.yml", "name": "source_unique_stg_finance_navision_sp_fitting_header_salesforce_id", "resource_type": "test", "alias": "source_unique_stg_finance_navision_sp_fitting_header_salesforce_id", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "severity": "WARN", "transient": true}, "tags": ["schema"], "refs": [], "sources": [["stg_finance", "navision_sp_fitting_header"]], "depends_on": {"macros": ["macro.dbt.test_unique"], "nodes": ["source.partner_portal.stg_finance.navision_sp_fitting_header"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/staging/stg_finance/src_stg_finance.yml/schema_test/source_unique_stg_finance_navision_sp_fitting_header_salesforce_id.sql", "compiled": true, "compiled_sql": "\n\n\n\nselect count(*) as validation_errors\nfrom (\n\n    select\n        salesforce_id\n\n    from partner_portal.stg_finance.navision_sp_fitting_header\n    where salesforce_id is not null\n    group by salesforce_id\n    having count(*) > 1\n\n) validation_errors\n\n", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "\n\n\n\nselect count(*) as validation_errors\nfrom (\n\n    select\n        salesforce_id\n\n    from partner_portal.stg_finance.navision_sp_fitting_header\n    where salesforce_id is not null\n    group by salesforce_id\n    having count(*) > 1\n\n) validation_errors\n\n", "column_name": "salesforce_id"}, "error": null, "status": null, "execution_time": 0.03137040138244629, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:07.431743Z", "completed_at": "2020-10-11T11:00:07.462249Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.462647Z", "completed_at": "2020-10-11T11:00:07.462657Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "{{ config(severity='WARN') }}{{ test_accepted_values(**_dbt_schema_test_kwargs) }}", "test_metadata": {"namespace": null, "name": "accepted_values", "kwargs": {"values": ["CAN", "CHE", "CHN", "DEU", "FRA", "GBR", "HKG", "IND", "JPN", "KOR", "MYS", "N/A", "NLD", "SGP", "THA", "USA", "ZAF'"], "column_name": "country_code_iso3", "model": "{{ ref('stg_dim_opportunity') }}"}}, "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "schema_test", "accepted_values_stg_dim_opportunity_country_code_iso3__CAN__CHE__CHN__DEU__FRA__GBR__HKG__IND__JPN__KOR__MYS__N_A__NLD__SGP__THA__USA__ZAF_"], "unique_id": "test.partner_portal.accepted_values_stg_dim_opportunity_country_code_iso3__CAN__CHE__CHN__DEU__FRA__GBR__HKG__IND__JPN__KOR__MYS__N_A__NLD__SGP__THA__USA__ZAF_", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "schema_test/accepted_values_stg_dim_opportunity_777efc2848f4a78747608c876e2973b6.sql", "original_file_path": "models/staging/datamart/stg_datamart.yml", "name": "accepted_values_stg_dim_opportunity_country_code_iso3__CAN__CHE__CHN__DEU__FRA__GBR__HKG__IND__JPN__KOR__MYS__N_A__NLD__SGP__THA__USA__ZAF_", "resource_type": "test", "alias": "accepted_values_stg_dim_opportunity_country_code_iso3__CAN__CHE__CHN__DEU__FRA__GBR__HKG__IND__JPN__KOR__MYS__N_A__NLD__SGP__THA__USA__ZAF_", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "severity": "WARN", "transient": true}, "tags": ["schema"], "refs": [["stg_dim_opportunity"]], "sources": [], "depends_on": {"macros": ["macro.dbt.test_accepted_values"], "nodes": ["model.partner_portal.stg_dim_opportunity"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/staging/datamart/stg_datamart.yml/schema_test/accepted_values_stg_dim_opportunity_777efc2848f4a78747608c876e2973b6.sql", "compiled": true, "compiled_sql": "\n\n\n\n\nwith all_values as (\n\n    select distinct\n        country_code_iso3 as value_field\n\n    from PARTNER_PORTAL.dbt_adhingra.stg_dim_opportunity\n\n),\n\nvalidation_errors as (\n\n    select\n        value_field\n\n    from all_values\n    where value_field not in (\n        'CAN','CHE','CHN','DEU','FRA','GBR','HKG','IND','JPN','KOR','MYS','N/A','NLD','SGP','THA','USA','ZAF''\n    )\n)\n\nselect count(*) as validation_errors\nfrom validation_errors\n\n", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "\n\n\n\n\nwith all_values as (\n\n    select distinct\n        country_code_iso3 as value_field\n\n    from PARTNER_PORTAL.dbt_adhingra.stg_dim_opportunity\n\n),\n\nvalidation_errors as (\n\n    select\n        value_field\n\n    from all_values\n    where value_field not in (\n        'CAN','CHE','CHN','DEU','FRA','GBR','HKG','IND','JPN','KOR','MYS','N/A','NLD','SGP','THA','USA','ZAF''\n    )\n)\n\nselect count(*) as validation_errors\nfrom validation_errors\n\n", "column_name": "country_code_iso3"}, "error": null, "status": null, "execution_time": 0.03776121139526367, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:07.463351Z", "completed_at": "2020-10-11T11:00:07.500003Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.500542Z", "completed_at": "2020-10-11T11:00:07.500556Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "{{ config(severity='WARN') }}{{ test_not_null(**_dbt_schema_test_kwargs) }}", "test_metadata": {"namespace": null, "name": "not_null", "kwargs": {"column_name": "id", "model": "{{ ref('stg_dim_opportunity') }}"}}, "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "schema_test", "not_null_stg_dim_opportunity_id"], "unique_id": "test.partner_portal.not_null_stg_dim_opportunity_id", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "schema_test/not_null_stg_dim_opportunity_id.sql", "original_file_path": "models/staging/datamart/stg_datamart.yml", "name": "not_null_stg_dim_opportunity_id", "resource_type": "test", "alias": "not_null_stg_dim_opportunity_id", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "severity": "WARN", "transient": true}, "tags": ["schema"], "refs": [["stg_dim_opportunity"]], "sources": [], "depends_on": {"macros": ["macro.dbt.test_not_null"], "nodes": ["model.partner_portal.stg_dim_opportunity"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/staging/datamart/stg_datamart.yml/schema_test/not_null_stg_dim_opportunity_id.sql", "compiled": true, "compiled_sql": "\n\n\n\nselect count(*) as validation_errors\nfrom PARTNER_PORTAL.dbt_adhingra.stg_dim_opportunity\nwhere id is null\n\n", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "\n\n\n\nselect count(*) as validation_errors\nfrom PARTNER_PORTAL.dbt_adhingra.stg_dim_opportunity\nwhere id is null\n\n", "column_name": "id"}, "error": null, "status": null, "execution_time": 0.052318572998046875, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:07.501591Z", "completed_at": "2020-10-11T11:00:07.552595Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.553177Z", "completed_at": "2020-10-11T11:00:07.553192Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "{{ config(severity='WARN') }}{{ test_not_null(**_dbt_schema_test_kwargs) }}", "test_metadata": {"namespace": null, "name": "not_null", "kwargs": {"column_name": "partner_id", "model": "{{ ref('stg_dim_opportunity') }}"}}, "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "schema_test", "not_null_stg_dim_opportunity_partner_id"], "unique_id": "test.partner_portal.not_null_stg_dim_opportunity_partner_id", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "schema_test/not_null_stg_dim_opportunity_partner_id.sql", "original_file_path": "models/staging/datamart/stg_datamart.yml", "name": "not_null_stg_dim_opportunity_partner_id", "resource_type": "test", "alias": "not_null_stg_dim_opportunity_partner_id", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "severity": "WARN", "transient": true}, "tags": ["schema"], "refs": [["stg_dim_opportunity"]], "sources": [], "depends_on": {"macros": ["macro.dbt.test_not_null"], "nodes": ["model.partner_portal.stg_dim_opportunity"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/staging/datamart/stg_datamart.yml/schema_test/not_null_stg_dim_opportunity_partner_id.sql", "compiled": true, "compiled_sql": "\n\n\n\nselect count(*) as validation_errors\nfrom PARTNER_PORTAL.dbt_adhingra.stg_dim_opportunity\nwhere partner_id is null\n\n", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "\n\n\n\nselect count(*) as validation_errors\nfrom PARTNER_PORTAL.dbt_adhingra.stg_dim_opportunity\nwhere partner_id is null\n\n", "column_name": "partner_id"}, "error": null, "status": null, "execution_time": 0.036185264587402344, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:07.554122Z", "completed_at": "2020-10-11T11:00:07.589086Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.589713Z", "completed_at": "2020-10-11T11:00:07.589728Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "{{ config(severity='WARN') }}{{ test_unique(**_dbt_schema_test_kwargs) }}", "test_metadata": {"namespace": null, "name": "unique", "kwargs": {"column_name": "id", "model": "{{ ref('stg_dim_opportunity') }}"}}, "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "schema_test", "unique_stg_dim_opportunity_id"], "unique_id": "test.partner_portal.unique_stg_dim_opportunity_id", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "schema_test/unique_stg_dim_opportunity_id.sql", "original_file_path": "models/staging/datamart/stg_datamart.yml", "name": "unique_stg_dim_opportunity_id", "resource_type": "test", "alias": "unique_stg_dim_opportunity_id", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "severity": "WARN", "transient": true}, "tags": ["schema"], "refs": [["stg_dim_opportunity"]], "sources": [], "depends_on": {"macros": ["macro.dbt.test_unique"], "nodes": ["model.partner_portal.stg_dim_opportunity"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/staging/datamart/stg_datamart.yml/schema_test/unique_stg_dim_opportunity_id.sql", "compiled": true, "compiled_sql": "\n\n\n\nselect count(*) as validation_errors\nfrom (\n\n    select\n        id\n\n    from PARTNER_PORTAL.dbt_adhingra.stg_dim_opportunity\n    where id is not null\n    group by id\n    having count(*) > 1\n\n) validation_errors\n\n", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "\n\n\n\nselect count(*) as validation_errors\nfrom (\n\n    select\n        id\n\n    from PARTNER_PORTAL.dbt_adhingra.stg_dim_opportunity\n    where id is not null\n    group by id\n    having count(*) > 1\n\n) validation_errors\n\n", "column_name": "id"}, "error": null, "status": null, "execution_time": 0.034188032150268555, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:07.590747Z", "completed_at": "2020-10-11T11:00:07.624032Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.624445Z", "completed_at": "2020-10-11T11:00:07.624456Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "{{ config(severity='WARN') }}{{ test_unique(**_dbt_schema_test_kwargs) }}", "test_metadata": {"namespace": null, "name": "unique", "kwargs": {"column_name": "partner_id", "model": "{{ ref('stg_dim_opportunity') }}"}}, "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "schema_test", "unique_stg_dim_opportunity_partner_id"], "unique_id": "test.partner_portal.unique_stg_dim_opportunity_partner_id", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "schema_test/unique_stg_dim_opportunity_partner_id.sql", "original_file_path": "models/staging/datamart/stg_datamart.yml", "name": "unique_stg_dim_opportunity_partner_id", "resource_type": "test", "alias": "unique_stg_dim_opportunity_partner_id", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "severity": "WARN", "transient": true}, "tags": ["schema"], "refs": [["stg_dim_opportunity"]], "sources": [], "depends_on": {"macros": ["macro.dbt.test_unique"], "nodes": ["model.partner_portal.stg_dim_opportunity"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/staging/datamart/stg_datamart.yml/schema_test/unique_stg_dim_opportunity_partner_id.sql", "compiled": true, "compiled_sql": "\n\n\n\nselect count(*) as validation_errors\nfrom (\n\n    select\n        partner_id\n\n    from PARTNER_PORTAL.dbt_adhingra.stg_dim_opportunity\n    where partner_id is not null\n    group by partner_id\n    having count(*) > 1\n\n) validation_errors\n\n", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "\n\n\n\nselect count(*) as validation_errors\nfrom (\n\n    select\n        partner_id\n\n    from PARTNER_PORTAL.dbt_adhingra.stg_dim_opportunity\n    where partner_id is not null\n    group by partner_id\n    having count(*) > 1\n\n) validation_errors\n\n", "column_name": "partner_id"}, "error": null, "status": null, "execution_time": 0.031937599182128906, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:07.625081Z", "completed_at": "2020-10-11T11:00:07.656171Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.656611Z", "completed_at": "2020-10-11T11:00:07.656622Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "-- uses only dim_opp and dim_partner subsidiary, calculates ongoing potential and avg_days_to_first_appointment +network\nWITH ocd_metrics AS (\n      SELECT\n        p.parent_id,\n        p.id,\n        date_trunc('year', cast(o.created_date as timestamp)) :: DATE                                               AS date_year,\n        count(o.id)                                                                              AS customer_potential,\n        count(case when o.stage_name NOT IN ('in process', 'appointment to be made', 'on hold') then o.id end) AS ongoing_potential,\n        avg(case when o.days_to_first_appointment IS NOT NULL AND o.days_to_first_appointment < 60 then o.days_to_first_appointment end)  AS avg_days_to_first_appointment\n      FROM {{ref('stg_dim_opportunity')}} as o\n        LEFT JOIN {{ref('stg_dim_partner_subsidiary')}} as p ON o.partner_id = p.id\n      WHERE o.country_code_iso3 = 'DEU' AND p.id IS NOT NULL\n      GROUP BY 1, 2, 3\n  ), ranked AS (\n      SELECT\n        ocd.*,\n        row_number()\n        OVER (\n          PARTITION BY ocd.date_year\n          ORDER BY avg_days_to_first_appointment ASC ) AS avg_days_to_first_appointment_rank,\n        row_number()\n        OVER (\n          PARTITION BY ocd.date_year\n          ORDER BY customer_potential DESC )           AS customer_potential_rank\n      FROM ocd_metrics ocd\n  ), top20 AS (\n      SELECT\n        date_year,\n        avg(case when avg_days_to_first_appointment_rank <= 20 then avg_days_to_first_appointment end) AS top20_avg_days_to_first_appointment,\n        avg(case when customer_potential_rank <= 20 then customer_potential end) AS top20_customer_potential\n      FROM ranked\n      GROUP BY 1\n  ), market_avg AS (\n      SELECT\n        date_year,\n        avg(customer_potential)            AS market_avg_customer_potential,\n        avg(avg_days_to_first_appointment) AS market_avg_days_to_first_appointment\n      FROM ocd_metrics\n      GROUP BY 1\n  ) SELECT\n      ocd.*,\n      top20.top20_avg_days_to_first_appointment,\n      top20_customer_potential,\n      market_avg_customer_potential,\n      market_avg_days_to_first_appointment\n    FROM ocd_metrics ocd\n      LEFT JOIN top20 ON ocd.date_year = top20.date_year\n      LEFT JOIN market_avg ON ocd.date_year = market_avg.date_year", "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "views_per_country", "deu_ocd_yearly"], "unique_id": "model.partner_portal.deu_ocd_yearly", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "views_per_country/deu_ocd_yearly.sql", "original_file_path": "models/views_per_country/deu_ocd_yearly.sql", "name": "deu_ocd_yearly", "resource_type": "model", "alias": "deu_ocd_yearly", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "transient": true}, "tags": [], "refs": [["stg_dim_opportunity"], ["stg_dim_partner_subsidiary"]], "sources": [], "depends_on": {"macros": [], "nodes": ["model.partner_portal.stg_dim_opportunity", "model.partner_portal.stg_dim_partner_subsidiary"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/views_per_country/deu_ocd_yearly.sql", "compiled": true, "compiled_sql": "-- uses only dim_opp and dim_partner subsidiary, calculates ongoing potential and avg_days_to_first_appointment +network\nWITH ocd_metrics AS (\n      SELECT\n        p.parent_id,\n        p.id,\n        date_trunc('year', cast(o.created_date as timestamp)) :: DATE                                               AS date_year,\n        count(o.id)                                                                              AS customer_potential,\n        count(case when o.stage_name NOT IN ('in process', 'appointment to be made', 'on hold') then o.id end) AS ongoing_potential,\n        avg(case when o.days_to_first_appointment IS NOT NULL AND o.days_to_first_appointment < 60 then o.days_to_first_appointment end)  AS avg_days_to_first_appointment\n      FROM PARTNER_PORTAL.dbt_adhingra.stg_dim_opportunity as o\n        LEFT JOIN PARTNER_PORTAL.dbt_adhingra.stg_dim_partner_subsidiary as p ON o.partner_id = p.id\n      WHERE o.country_code_iso3 = 'DEU' AND p.id IS NOT NULL\n      GROUP BY 1, 2, 3\n  ), ranked AS (\n      SELECT\n        ocd.*,\n        row_number()\n        OVER (\n          PARTITION BY ocd.date_year\n          ORDER BY avg_days_to_first_appointment ASC ) AS avg_days_to_first_appointment_rank,\n        row_number()\n        OVER (\n          PARTITION BY ocd.date_year\n          ORDER BY customer_potential DESC )           AS customer_potential_rank\n      FROM ocd_metrics ocd\n  ), top20 AS (\n      SELECT\n        date_year,\n        avg(case when avg_days_to_first_appointment_rank <= 20 then avg_days_to_first_appointment end) AS top20_avg_days_to_first_appointment,\n        avg(case when customer_potential_rank <= 20 then customer_potential end) AS top20_customer_potential\n      FROM ranked\n      GROUP BY 1\n  ), market_avg AS (\n      SELECT\n        date_year,\n        avg(customer_potential)            AS market_avg_customer_potential,\n        avg(avg_days_to_first_appointment) AS market_avg_days_to_first_appointment\n      FROM ocd_metrics\n      GROUP BY 1\n  ) SELECT\n      ocd.*,\n      top20.top20_avg_days_to_first_appointment,\n      top20_customer_potential,\n      market_avg_customer_potential,\n      market_avg_days_to_first_appointment\n    FROM ocd_metrics ocd\n      LEFT JOIN top20 ON ocd.date_year = top20.date_year\n      LEFT JOIN market_avg ON ocd.date_year = market_avg.date_year", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "-- uses only dim_opp and dim_partner subsidiary, calculates ongoing potential and avg_days_to_first_appointment +network\nWITH ocd_metrics AS (\n      SELECT\n        p.parent_id,\n        p.id,\n        date_trunc('year', cast(o.created_date as timestamp)) :: DATE                                               AS date_year,\n        count(o.id)                                                                              AS customer_potential,\n        count(case when o.stage_name NOT IN ('in process', 'appointment to be made', 'on hold') then o.id end) AS ongoing_potential,\n        avg(case when o.days_to_first_appointment IS NOT NULL AND o.days_to_first_appointment < 60 then o.days_to_first_appointment end)  AS avg_days_to_first_appointment\n      FROM PARTNER_PORTAL.dbt_adhingra.stg_dim_opportunity as o\n        LEFT JOIN PARTNER_PORTAL.dbt_adhingra.stg_dim_partner_subsidiary as p ON o.partner_id = p.id\n      WHERE o.country_code_iso3 = 'DEU' AND p.id IS NOT NULL\n      GROUP BY 1, 2, 3\n  ), ranked AS (\n      SELECT\n        ocd.*,\n        row_number()\n        OVER (\n          PARTITION BY ocd.date_year\n          ORDER BY avg_days_to_first_appointment ASC ) AS avg_days_to_first_appointment_rank,\n        row_number()\n        OVER (\n          PARTITION BY ocd.date_year\n          ORDER BY customer_potential DESC )           AS customer_potential_rank\n      FROM ocd_metrics ocd\n  ), top20 AS (\n      SELECT\n        date_year,\n        avg(case when avg_days_to_first_appointment_rank <= 20 then avg_days_to_first_appointment end) AS top20_avg_days_to_first_appointment,\n        avg(case when customer_potential_rank <= 20 then customer_potential end) AS top20_customer_potential\n      FROM ranked\n      GROUP BY 1\n  ), market_avg AS (\n      SELECT\n        date_year,\n        avg(customer_potential)            AS market_avg_customer_potential,\n        avg(avg_days_to_first_appointment) AS market_avg_days_to_first_appointment\n      FROM ocd_metrics\n      GROUP BY 1\n  ) SELECT\n      ocd.*,\n      top20.top20_avg_days_to_first_appointment,\n      top20_customer_potential,\n      market_avg_customer_potential,\n      market_avg_days_to_first_appointment\n    FROM ocd_metrics ocd\n      LEFT JOIN top20 ON ocd.date_year = top20.date_year\n      LEFT JOIN market_avg ON ocd.date_year = market_avg.date_year"}, "error": null, "status": null, "execution_time": 0.031355857849121094, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:07.657266Z", "completed_at": "2020-10-11T11:00:07.687779Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.688213Z", "completed_at": "2020-10-11T11:00:07.688223Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "{{ config(severity='WARN') }}{{ test_not_null(**_dbt_schema_test_kwargs) }}", "test_metadata": {"namespace": null, "name": "not_null", "kwargs": {"column_name": "id", "model": "{{ ref('stg_dim_partner_subsidiary') }}"}}, "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "schema_test", "not_null_stg_dim_partner_subsidiary_id"], "unique_id": "test.partner_portal.not_null_stg_dim_partner_subsidiary_id", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "schema_test/not_null_stg_dim_partner_subsidiary_id.sql", "original_file_path": "models/staging/datamart/stg_datamart.yml", "name": "not_null_stg_dim_partner_subsidiary_id", "resource_type": "test", "alias": "not_null_stg_dim_partner_subsidiary_id", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "severity": "WARN", "transient": true}, "tags": ["schema"], "refs": [["stg_dim_partner_subsidiary"]], "sources": [], "depends_on": {"macros": ["macro.dbt.test_not_null"], "nodes": ["model.partner_portal.stg_dim_partner_subsidiary"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/staging/datamart/stg_datamart.yml/schema_test/not_null_stg_dim_partner_subsidiary_id.sql", "compiled": true, "compiled_sql": "\n\n\n\nselect count(*) as validation_errors\nfrom PARTNER_PORTAL.dbt_adhingra.stg_dim_partner_subsidiary\nwhere id is null\n\n", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "\n\n\n\nselect count(*) as validation_errors\nfrom PARTNER_PORTAL.dbt_adhingra.stg_dim_partner_subsidiary\nwhere id is null\n\n", "column_name": "id"}, "error": null, "status": null, "execution_time": 0.02957439422607422, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:07.688861Z", "completed_at": "2020-10-11T11:00:07.717464Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.717904Z", "completed_at": "2020-10-11T11:00:07.717917Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "{{ config(severity='WARN') }}{{ test_unique(**_dbt_schema_test_kwargs) }}", "test_metadata": {"namespace": null, "name": "unique", "kwargs": {"column_name": "id", "model": "{{ ref('stg_dim_partner_subsidiary') }}"}}, "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "schema_test", "unique_stg_dim_partner_subsidiary_id"], "unique_id": "test.partner_portal.unique_stg_dim_partner_subsidiary_id", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "schema_test/unique_stg_dim_partner_subsidiary_id.sql", "original_file_path": "models/staging/datamart/stg_datamart.yml", "name": "unique_stg_dim_partner_subsidiary_id", "resource_type": "test", "alias": "unique_stg_dim_partner_subsidiary_id", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "severity": "WARN", "transient": true}, "tags": ["schema"], "refs": [["stg_dim_partner_subsidiary"]], "sources": [], "depends_on": {"macros": ["macro.dbt.test_unique"], "nodes": ["model.partner_portal.stg_dim_partner_subsidiary"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/staging/datamart/stg_datamart.yml/schema_test/unique_stg_dim_partner_subsidiary_id.sql", "compiled": true, "compiled_sql": "\n\n\n\nselect count(*) as validation_errors\nfrom (\n\n    select\n        id\n\n    from PARTNER_PORTAL.dbt_adhingra.stg_dim_partner_subsidiary\n    where id is not null\n    group by id\n    having count(*) > 1\n\n) validation_errors\n\n", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "\n\n\n\nselect count(*) as validation_errors\nfrom (\n\n    select\n        id\n\n    from PARTNER_PORTAL.dbt_adhingra.stg_dim_partner_subsidiary\n    where id is not null\n    group by id\n    having count(*) > 1\n\n) validation_errors\n\n", "column_name": "id"}, "error": null, "status": null, "execution_time": 0.03137087821960449, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:07.718861Z", "completed_at": "2020-10-11T11:00:07.749309Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.749750Z", "completed_at": "2020-10-11T11:00:07.749761Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "WITH sf_final_quote AS (\n    -- Get id/discount__c of the \"final final\" quote\n      SELECT\n        id,\n        total_discount__c\n      FROM {{ref('stg_salesforce_quote')}} q INNER JOIN\n        -- Sub-query defines the \"final final\" quote on a given opportunity. Def provided by Oliver O.\n        (\n          SELECT\n            opportunityid,\n            max(createddate) AS createddate\n          FROM {{ref('stg_salesforce_quote')}}\n          WHERE status = 'Final Quote' AND coalesce(hearing_aid_right__c, hearing_aid_left__c) IS NOT NULL\n          -- WHERE status = 'Final Quote' AND total__c >= 1000     NOTE: OLD Definition\n          GROUP BY 1\n        ) max_quote ON q.opportunityid = max_quote.opportunityid AND q.createddate = max_quote.createddate\n  ), mfr_counts AS (\n      SELECT\n        fh.country_code_iso3,\n        fh.salesforce_id,\n        mfr.name       AS manufacturer,\n        count(itm.no_) AS number_of_devices\n      FROM {{ref('stg_navision_sp_fitting_header')}} fh\n        INNER JOIN {{ref('stg_navision_sp_fitting_line')}} fl\n          ON fh.no_ = fl.fitting_process_no_ AND fh.country_code_iso3 = fl.country_code_iso3\n        INNER JOIN sf_final_quote fq ON fh.salesforce_id = fq.id\n        LEFT JOIN {{ref('stg_navision_item')}} AS itm\n          ON fl.no_ = itm.no_ AND fl.country_code_iso3 = itm.country_code_iso3 AND itm.item_category_code = 'HA'\n        LEFT JOIN {{ref('stg_navision_manufacturer')}} mfr\n          ON itm.country_code_iso3 = mfr.country_code_iso3 AND itm.manufacturer_code = mfr.code\n      WHERE fh.country_code_iso3 IN ('DEU') AND mfr.code IS NOT NULL\n      GROUP BY 1, 2, 3\n  )\n  SELECT\n    p.parent_id,\n    p.id,\n    mfr_counts.manufacturer,\n    date_trunc('year', cast(o.finished_date as timestamp)) :: DATE AS date_month,\n    sum(number_of_devices)                      AS number_of_devices\n  FROM mfr_counts\n    INNER JOIN {{ref('stg_salesforce_quote')}} as q ON mfr_counts.salesforce_id = q.id\n    INNER JOIN {{ref('stg_dim_opportunity')}} as o ON q.opportunityid = o.id\n    LEFT JOIN {{ref('stg_dim_partner_subsidiary')}} as p ON o.partner_id = p.id\n  WHERE o.stage_name = 'closed and won' -- AND date_trunc('month', o.finished_date) :: DATE >= '2017-10-01'\n  GROUP BY 1, 2, 3, 4\n  ORDER BY 4 DESC", "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "views_per_country", "deu_device_yearly"], "unique_id": "model.partner_portal.deu_device_yearly", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "views_per_country/deu_device_yearly.sql", "original_file_path": "models/views_per_country/deu_device_yearly.sql", "name": "deu_device_yearly", "resource_type": "model", "alias": "deu_device_yearly", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "transient": true}, "tags": [], "refs": [["stg_salesforce_quote"], ["stg_salesforce_quote"], ["stg_navision_sp_fitting_header"], ["stg_navision_sp_fitting_line"], ["stg_navision_item"], ["stg_navision_manufacturer"], ["stg_salesforce_quote"], ["stg_dim_opportunity"], ["stg_dim_partner_subsidiary"]], "sources": [], "depends_on": {"macros": [], "nodes": ["model.partner_portal.stg_salesforce_quote", "model.partner_portal.stg_salesforce_quote", "model.partner_portal.stg_navision_sp_fitting_header", "model.partner_portal.stg_navision_sp_fitting_line", "model.partner_portal.stg_navision_item", "model.partner_portal.stg_navision_manufacturer", "model.partner_portal.stg_salesforce_quote", "model.partner_portal.stg_dim_opportunity", "model.partner_portal.stg_dim_partner_subsidiary"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/views_per_country/deu_device_yearly.sql", "compiled": true, "compiled_sql": "WITH sf_final_quote AS (\n    -- Get id/discount__c of the \"final final\" quote\n      SELECT\n        id,\n        total_discount__c\n      FROM PARTNER_PORTAL.dbt_adhingra.stg_salesforce_quote q INNER JOIN\n        -- Sub-query defines the \"final final\" quote on a given opportunity. Def provided by Oliver O.\n        (\n          SELECT\n            opportunityid,\n            max(createddate) AS createddate\n          FROM PARTNER_PORTAL.dbt_adhingra.stg_salesforce_quote\n          WHERE status = 'Final Quote' AND coalesce(hearing_aid_right__c, hearing_aid_left__c) IS NOT NULL\n          -- WHERE status = 'Final Quote' AND total__c >= 1000     NOTE: OLD Definition\n          GROUP BY 1\n        ) max_quote ON q.opportunityid = max_quote.opportunityid AND q.createddate = max_quote.createddate\n  ), mfr_counts AS (\n      SELECT\n        fh.country_code_iso3,\n        fh.salesforce_id,\n        mfr.name       AS manufacturer,\n        count(itm.no_) AS number_of_devices\n      FROM PARTNER_PORTAL.dbt_adhingra.stg_navision_sp_fitting_header fh\n        INNER JOIN PARTNER_PORTAL.dbt_adhingra.stg_navision_sp_fitting_line fl\n          ON fh.no_ = fl.fitting_process_no_ AND fh.country_code_iso3 = fl.country_code_iso3\n        INNER JOIN sf_final_quote fq ON fh.salesforce_id = fq.id\n        LEFT JOIN PARTNER_PORTAL.dbt_adhingra.stg_navision_item AS itm\n          ON fl.no_ = itm.no_ AND fl.country_code_iso3 = itm.country_code_iso3 AND itm.item_category_code = 'HA'\n        LEFT JOIN PARTNER_PORTAL.dbt_adhingra.stg_navision_manufacturer mfr\n          ON itm.country_code_iso3 = mfr.country_code_iso3 AND itm.manufacturer_code = mfr.code\n      WHERE fh.country_code_iso3 IN ('DEU') AND mfr.code IS NOT NULL\n      GROUP BY 1, 2, 3\n  )\n  SELECT\n    p.parent_id,\n    p.id,\n    mfr_counts.manufacturer,\n    date_trunc('year', cast(o.finished_date as timestamp)) :: DATE AS date_month,\n    sum(number_of_devices)                      AS number_of_devices\n  FROM mfr_counts\n    INNER JOIN PARTNER_PORTAL.dbt_adhingra.stg_salesforce_quote as q ON mfr_counts.salesforce_id = q.id\n    INNER JOIN PARTNER_PORTAL.dbt_adhingra.stg_dim_opportunity as o ON q.opportunityid = o.id\n    LEFT JOIN PARTNER_PORTAL.dbt_adhingra.stg_dim_partner_subsidiary as p ON o.partner_id = p.id\n  WHERE o.stage_name = 'closed and won' -- AND date_trunc('month', o.finished_date) :: DATE >= '2017-10-01'\n  GROUP BY 1, 2, 3, 4\n  ORDER BY 4 DESC", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "WITH sf_final_quote AS (\n    -- Get id/discount__c of the \"final final\" quote\n      SELECT\n        id,\n        total_discount__c\n      FROM PARTNER_PORTAL.dbt_adhingra.stg_salesforce_quote q INNER JOIN\n        -- Sub-query defines the \"final final\" quote on a given opportunity. Def provided by Oliver O.\n        (\n          SELECT\n            opportunityid,\n            max(createddate) AS createddate\n          FROM PARTNER_PORTAL.dbt_adhingra.stg_salesforce_quote\n          WHERE status = 'Final Quote' AND coalesce(hearing_aid_right__c, hearing_aid_left__c) IS NOT NULL\n          -- WHERE status = 'Final Quote' AND total__c >= 1000     NOTE: OLD Definition\n          GROUP BY 1\n        ) max_quote ON q.opportunityid = max_quote.opportunityid AND q.createddate = max_quote.createddate\n  ), mfr_counts AS (\n      SELECT\n        fh.country_code_iso3,\n        fh.salesforce_id,\n        mfr.name       AS manufacturer,\n        count(itm.no_) AS number_of_devices\n      FROM PARTNER_PORTAL.dbt_adhingra.stg_navision_sp_fitting_header fh\n        INNER JOIN PARTNER_PORTAL.dbt_adhingra.stg_navision_sp_fitting_line fl\n          ON fh.no_ = fl.fitting_process_no_ AND fh.country_code_iso3 = fl.country_code_iso3\n        INNER JOIN sf_final_quote fq ON fh.salesforce_id = fq.id\n        LEFT JOIN PARTNER_PORTAL.dbt_adhingra.stg_navision_item AS itm\n          ON fl.no_ = itm.no_ AND fl.country_code_iso3 = itm.country_code_iso3 AND itm.item_category_code = 'HA'\n        LEFT JOIN PARTNER_PORTAL.dbt_adhingra.stg_navision_manufacturer mfr\n          ON itm.country_code_iso3 = mfr.country_code_iso3 AND itm.manufacturer_code = mfr.code\n      WHERE fh.country_code_iso3 IN ('DEU') AND mfr.code IS NOT NULL\n      GROUP BY 1, 2, 3\n  )\n  SELECT\n    p.parent_id,\n    p.id,\n    mfr_counts.manufacturer,\n    date_trunc('year', cast(o.finished_date as timestamp)) :: DATE AS date_month,\n    sum(number_of_devices)                      AS number_of_devices\n  FROM mfr_counts\n    INNER JOIN PARTNER_PORTAL.dbt_adhingra.stg_salesforce_quote as q ON mfr_counts.salesforce_id = q.id\n    INNER JOIN PARTNER_PORTAL.dbt_adhingra.stg_dim_opportunity as o ON q.opportunityid = o.id\n    LEFT JOIN PARTNER_PORTAL.dbt_adhingra.stg_dim_partner_subsidiary as p ON o.partner_id = p.id\n  WHERE o.stage_name = 'closed and won' -- AND date_trunc('month', o.finished_date) :: DATE >= '2017-10-01'\n  GROUP BY 1, 2, 3, 4\n  ORDER BY 4 DESC"}, "error": null, "status": null, "execution_time": 0.09299373626708984, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:07.750384Z", "completed_at": "2020-10-11T11:00:07.842566Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.842983Z", "completed_at": "2020-10-11T11:00:07.842993Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "WITH fd_metrics AS (\n      SELECT\n        p.parent_id,\n        p.id,\n        date_trunc('year', cast(o.finished_date as date)) :: DATE AS date_year,        \n        case when sum(case when o.stage_name in ('closed and won','closed and lost') then 1 else 0 end) > 0 then\n        (sum(case when o.stage_name = 'closed and won' then 1 else 0 END) / sum(case when o.stage_name in ('closed and won','closed and lost') then 1 else 0 END) ):: NUMERIC end as conversion_rate,\n        \n/*    -- conversion rate in kirll's code\n        CASE WHEN COUNT(o.id)\n                    FILTER (WHERE stage_name =\n                                  'closed and won') > 0 OR COUNT(o.id)\n                                                             FILTER (WHERE stage_name =\n                                                                           'closed and lost') > 0\n          THEN\n            COUNT(o.id)\n              FILTER (WHERE stage_name = 'closed and won') :: NUMERIC / (COUNT(o.id)\n                                                                           FILTER (WHERE stage_name =\n                                                                                         'closed and won') :: NUMERIC\n                                                                         + COUNT(o.id)\n                                                                           FILTER (WHERE stage_name =\n                                                                                         'closed and lost') :: NUMERIC) END AS conversion_rate,\n*/\n        case when\n         sum(case when o.stage_name = 'closed and won' and (o.gross_process_duration IS NULL OR o.gross_process_duration <= 170) then 1 else 0 END) > 0\n        THEN\n        sum(case when o.stage_name = 'closed and won' AND (o.gross_process_duration IS NULL OR o.gross_process_duration <= 170) then o.gross_process_duration else 0 end) / sum(case when \n        o.stage_name = 'closed and won' AND (o.gross_process_duration IS NULL OR o.gross_process_duration <= 170) then 1 else 0 end) end as gross_process_duration,\n\n\n/*\n        CASE WHEN count(o.id)\n                    FILTER (WHERE stage_name =\n                                  'closed and won' AND\n                                  (o.gross_process_duration IS NULL OR o.gross_process_duration <= 170)) > 0\n          THEN sum(o.gross_process_duration)\n                 FILTER (WHERE stage_name = 'closed and won' AND\n                               (o.gross_process_duration IS NULL OR o.gross_process_duration <= 170)) / count(o.id)\n                 FILTER (WHERE stage_name =\n                               'closed and won' AND\n                               (o.gross_process_duration IS NULL OR o.gross_process_duration <= 170))\n        ELSE 0 END   AS gross_process_duration,\n*/ --gross_process_duration\n\ncase when\nsum(case when o.stage_name = 'closed and won' then o.nav_number_of_hearing_aids end ) > 0\nthen  \nsum(case when o.stage_name = 'closed and won' then o.nav_revenue_local end) /\nsum(case when o.stage_name = 'closed and won' then o.nav_number_of_hearing_aids end)\nelse 0 end as asp\n\n/*        CASE\n        WHEN sum(o.nav_number_of_hearing_aids) FILTER (WHERE stage_name = 'closed and won') > 0\n          THEN (sum(o.nav_revenue_local)\n                  FILTER (WHERE stage_name = 'closed and won') / sum(o.nav_number_of_hearing_aids)\n                  FILTER (WHERE stage_name = 'closed and won'))\n        ELSE 0\n        END   AS asp\n*/\n      FROM {{ref('stg_dim_opportunity')}} AS o\n        JOIN {{ref('stg_dim_partner_subsidiary')}} AS p ON o.partner_id = p.id\n            WHERE o.country_code_iso3 = 'DEU' AND o.finished_date IS NOT NULL\n      GROUP BY 1, 2, 3\n  ),\nranked AS (\n      SELECT\n        fd.parent_id,\n        fd.id,\n        fd.date_year,\n        conversion_rate,\n        asp,\n        gross_process_duration,\n        row_number()\n        OVER (\n          PARTITION BY fd.date_year\n          ORDER BY conversion_rate DESC )                             AS rank_conversion_rate,\n        row_number()\n        OVER (\n          PARTITION BY fd.date_year\n          ORDER BY asp DESC )                                         AS rank_asp,\n        row_number()\n        OVER (\n          PARTITION BY fd.date_year\n          ORDER BY nullif(gross_process_duration, 0) ASC NULLS LAST ) AS rank_gross_process_duration\n      FROM fd_metrics fd\n        LEFT JOIN {{ref('deu_ocd_yearly')}} ocd\n          ON fd.id = ocd.id AND fd.date_year = ocd.date_year\n      WHERE ocd.customer_potential >= 10\n  ), avg AS (\n      SELECT\n        date_year,\n        avg(case when rank_conversion_rate <= 20 then conversion_rate end) AS top20_conversion_rate,\n/*        avg(conversion_rate)\n          FILTER (WHERE rank_conversion_rate <= 20)        AS top20_conversion_rate, */\n        avg(conversion_rate) + 0.07                        AS market_avg_conversion_rate, -- Pad the market average as per P.C. by 7% for partner motivation\n        avg(case when rank_asp <=20 then asp end) as top20_asp,\n/*        avg(asp)\n          FILTER (WHERE rank_asp <= 20)                    AS top20_asp, \n          */\n        avg(asp) AS market_avg_asp,\n        avg(case when rank_gross_process_duration <= 20 then gross_process_duration end) as top20_gross_process_duration,\n/*        avg(gross_process_duration)\n          FILTER (WHERE rank_gross_process_duration <= 20) AS top20_gross_process_duration,\n          */\n        avg(nullif(gross_process_duration, 0))             AS market_avg_gross_process_duration\n      FROM ranked\n      GROUP BY date_year\n  ), top1 AS (\n      SELECT\n        date_year,\n        conversion_rate      AS top1_conversion_rate\n      FROM ranked\n      WHERE rank_conversion_rate = 1\n  )\n  SELECT DISTINCT\n    fd.parent_id,\n    fd.id,\n    fd.date_year,\n    fd.conversion_rate,\n    fd.asp,\n    fd.gross_process_duration,\n    a.market_avg_asp,\n    a.market_avg_conversion_rate,\n    a.market_avg_gross_process_duration,\n    a.top20_asp,\n    a.top20_conversion_rate,\n    a.top20_gross_process_duration,\n    r.rank_asp,\n    r.rank_conversion_rate,\n    r.rank_gross_process_duration,\n    t.top1_conversion_rate\n  FROM fd_metrics fd\n    LEFT JOIN ranked AS r ON fd.id = r.id AND fd.date_year = r.date_year\n    LEFT JOIN avg a ON a.date_year = fd.date_year\n    LEFT JOIN top1 t ON t.date_year = fd.date_year", "database": "PARTNER_PORTAL", "schema": "dbt_adhingra", "fqn": ["partner_portal", "views_per_country", "deu_fd_yearly"], "unique_id": "model.partner_portal.deu_fd_yearly", "package_name": "partner_portal", "root_path": "/usr/src/develop/user-7231/environment-10757/repository-9029", "path": "views_per_country/deu_fd_yearly.sql", "original_file_path": "models/views_per_country/deu_fd_yearly.sql", "name": "deu_fd_yearly", "resource_type": "model", "alias": "deu_fd_yearly", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": [], "transient": true}, "tags": [], "refs": [["stg_dim_opportunity"], ["stg_dim_partner_subsidiary"], ["deu_ocd_yearly"]], "sources": [], "depends_on": {"macros": [], "nodes": ["model.partner_portal.stg_dim_opportunity", "model.partner_portal.stg_dim_partner_subsidiary", "model.partner_portal.deu_ocd_yearly"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/compiled/partner_portal/models/views_per_country/deu_fd_yearly.sql", "compiled": true, "compiled_sql": "WITH fd_metrics AS (\n      SELECT\n        p.parent_id,\n        p.id,\n        date_trunc('year', cast(o.finished_date as date)) :: DATE AS date_year,        \n        case when sum(case when o.stage_name in ('closed and won','closed and lost') then 1 else 0 end) > 0 then\n        (sum(case when o.stage_name = 'closed and won' then 1 else 0 END) / sum(case when o.stage_name in ('closed and won','closed and lost') then 1 else 0 END) ):: NUMERIC end as conversion_rate,\n        \n/*    -- conversion rate in kirll's code\n        CASE WHEN COUNT(o.id)\n                    FILTER (WHERE stage_name =\n                                  'closed and won') > 0 OR COUNT(o.id)\n                                                             FILTER (WHERE stage_name =\n                                                                           'closed and lost') > 0\n          THEN\n            COUNT(o.id)\n              FILTER (WHERE stage_name = 'closed and won') :: NUMERIC / (COUNT(o.id)\n                                                                           FILTER (WHERE stage_name =\n                                                                                         'closed and won') :: NUMERIC\n                                                                         + COUNT(o.id)\n                                                                           FILTER (WHERE stage_name =\n                                                                                         'closed and lost') :: NUMERIC) END AS conversion_rate,\n*/\n        case when\n         sum(case when o.stage_name = 'closed and won' and (o.gross_process_duration IS NULL OR o.gross_process_duration <= 170) then 1 else 0 END) > 0\n        THEN\n        sum(case when o.stage_name = 'closed and won' AND (o.gross_process_duration IS NULL OR o.gross_process_duration <= 170) then o.gross_process_duration else 0 end) / sum(case when \n        o.stage_name = 'closed and won' AND (o.gross_process_duration IS NULL OR o.gross_process_duration <= 170) then 1 else 0 end) end as gross_process_duration,\n\n\n/*\n        CASE WHEN count(o.id)\n                    FILTER (WHERE stage_name =\n                                  'closed and won' AND\n                                  (o.gross_process_duration IS NULL OR o.gross_process_duration <= 170)) > 0\n          THEN sum(o.gross_process_duration)\n                 FILTER (WHERE stage_name = 'closed and won' AND\n                               (o.gross_process_duration IS NULL OR o.gross_process_duration <= 170)) / count(o.id)\n                 FILTER (WHERE stage_name =\n                               'closed and won' AND\n                               (o.gross_process_duration IS NULL OR o.gross_process_duration <= 170))\n        ELSE 0 END   AS gross_process_duration,\n*/ --gross_process_duration\n\ncase when\nsum(case when o.stage_name = 'closed and won' then o.nav_number_of_hearing_aids end ) > 0\nthen  \nsum(case when o.stage_name = 'closed and won' then o.nav_revenue_local end) /\nsum(case when o.stage_name = 'closed and won' then o.nav_number_of_hearing_aids end)\nelse 0 end as asp\n\n/*        CASE\n        WHEN sum(o.nav_number_of_hearing_aids) FILTER (WHERE stage_name = 'closed and won') > 0\n          THEN (sum(o.nav_revenue_local)\n                  FILTER (WHERE stage_name = 'closed and won') / sum(o.nav_number_of_hearing_aids)\n                  FILTER (WHERE stage_name = 'closed and won'))\n        ELSE 0\n        END   AS asp\n*/\n      FROM PARTNER_PORTAL.dbt_adhingra.stg_dim_opportunity AS o\n        JOIN PARTNER_PORTAL.dbt_adhingra.stg_dim_partner_subsidiary AS p ON o.partner_id = p.id\n            WHERE o.country_code_iso3 = 'DEU' AND o.finished_date IS NOT NULL\n      GROUP BY 1, 2, 3\n  ),\nranked AS (\n      SELECT\n        fd.parent_id,\n        fd.id,\n        fd.date_year,\n        conversion_rate,\n        asp,\n        gross_process_duration,\n        row_number()\n        OVER (\n          PARTITION BY fd.date_year\n          ORDER BY conversion_rate DESC )                             AS rank_conversion_rate,\n        row_number()\n        OVER (\n          PARTITION BY fd.date_year\n          ORDER BY asp DESC )                                         AS rank_asp,\n        row_number()\n        OVER (\n          PARTITION BY fd.date_year\n          ORDER BY nullif(gross_process_duration, 0) ASC NULLS LAST ) AS rank_gross_process_duration\n      FROM fd_metrics fd\n        LEFT JOIN PARTNER_PORTAL.dbt_adhingra.deu_ocd_yearly ocd\n          ON fd.id = ocd.id AND fd.date_year = ocd.date_year\n      WHERE ocd.customer_potential >= 10\n  ), avg AS (\n      SELECT\n        date_year,\n        avg(case when rank_conversion_rate <= 20 then conversion_rate end) AS top20_conversion_rate,\n/*        avg(conversion_rate)\n          FILTER (WHERE rank_conversion_rate <= 20)        AS top20_conversion_rate, */\n        avg(conversion_rate) + 0.07                        AS market_avg_conversion_rate, -- Pad the market average as per P.C. by 7% for partner motivation\n        avg(case when rank_asp <=20 then asp end) as top20_asp,\n/*        avg(asp)\n          FILTER (WHERE rank_asp <= 20)                    AS top20_asp, \n          */\n        avg(asp) AS market_avg_asp,\n        avg(case when rank_gross_process_duration <= 20 then gross_process_duration end) as top20_gross_process_duration,\n/*        avg(gross_process_duration)\n          FILTER (WHERE rank_gross_process_duration <= 20) AS top20_gross_process_duration,\n          */\n        avg(nullif(gross_process_duration, 0))             AS market_avg_gross_process_duration\n      FROM ranked\n      GROUP BY date_year\n  ), top1 AS (\n      SELECT\n        date_year,\n        conversion_rate      AS top1_conversion_rate\n      FROM ranked\n      WHERE rank_conversion_rate = 1\n  )\n  SELECT DISTINCT\n    fd.parent_id,\n    fd.id,\n    fd.date_year,\n    fd.conversion_rate,\n    fd.asp,\n    fd.gross_process_duration,\n    a.market_avg_asp,\n    a.market_avg_conversion_rate,\n    a.market_avg_gross_process_duration,\n    a.top20_asp,\n    a.top20_conversion_rate,\n    a.top20_gross_process_duration,\n    r.rank_asp,\n    r.rank_conversion_rate,\n    r.rank_gross_process_duration,\n    t.top1_conversion_rate\n  FROM fd_metrics fd\n    LEFT JOIN ranked AS r ON fd.id = r.id AND fd.date_year = r.date_year\n    LEFT JOIN avg a ON a.date_year = fd.date_year\n    LEFT JOIN top1 t ON t.date_year = fd.date_year", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "WITH fd_metrics AS (\n      SELECT\n        p.parent_id,\n        p.id,\n        date_trunc('year', cast(o.finished_date as date)) :: DATE AS date_year,        \n        case when sum(case when o.stage_name in ('closed and won','closed and lost') then 1 else 0 end) > 0 then\n        (sum(case when o.stage_name = 'closed and won' then 1 else 0 END) / sum(case when o.stage_name in ('closed and won','closed and lost') then 1 else 0 END) ):: NUMERIC end as conversion_rate,\n        \n/*    -- conversion rate in kirll's code\n        CASE WHEN COUNT(o.id)\n                    FILTER (WHERE stage_name =\n                                  'closed and won') > 0 OR COUNT(o.id)\n                                                             FILTER (WHERE stage_name =\n                                                                           'closed and lost') > 0\n          THEN\n            COUNT(o.id)\n              FILTER (WHERE stage_name = 'closed and won') :: NUMERIC / (COUNT(o.id)\n                                                                           FILTER (WHERE stage_name =\n                                                                                         'closed and won') :: NUMERIC\n                                                                         + COUNT(o.id)\n                                                                           FILTER (WHERE stage_name =\n                                                                                         'closed and lost') :: NUMERIC) END AS conversion_rate,\n*/\n        case when\n         sum(case when o.stage_name = 'closed and won' and (o.gross_process_duration IS NULL OR o.gross_process_duration <= 170) then 1 else 0 END) > 0\n        THEN\n        sum(case when o.stage_name = 'closed and won' AND (o.gross_process_duration IS NULL OR o.gross_process_duration <= 170) then o.gross_process_duration else 0 end) / sum(case when \n        o.stage_name = 'closed and won' AND (o.gross_process_duration IS NULL OR o.gross_process_duration <= 170) then 1 else 0 end) end as gross_process_duration,\n\n\n/*\n        CASE WHEN count(o.id)\n                    FILTER (WHERE stage_name =\n                                  'closed and won' AND\n                                  (o.gross_process_duration IS NULL OR o.gross_process_duration <= 170)) > 0\n          THEN sum(o.gross_process_duration)\n                 FILTER (WHERE stage_name = 'closed and won' AND\n                               (o.gross_process_duration IS NULL OR o.gross_process_duration <= 170)) / count(o.id)\n                 FILTER (WHERE stage_name =\n                               'closed and won' AND\n                               (o.gross_process_duration IS NULL OR o.gross_process_duration <= 170))\n        ELSE 0 END   AS gross_process_duration,\n*/ --gross_process_duration\n\ncase when\nsum(case when o.stage_name = 'closed and won' then o.nav_number_of_hearing_aids end ) > 0\nthen  \nsum(case when o.stage_name = 'closed and won' then o.nav_revenue_local end) /\nsum(case when o.stage_name = 'closed and won' then o.nav_number_of_hearing_aids end)\nelse 0 end as asp\n\n/*        CASE\n        WHEN sum(o.nav_number_of_hearing_aids) FILTER (WHERE stage_name = 'closed and won') > 0\n          THEN (sum(o.nav_revenue_local)\n                  FILTER (WHERE stage_name = 'closed and won') / sum(o.nav_number_of_hearing_aids)\n                  FILTER (WHERE stage_name = 'closed and won'))\n        ELSE 0\n        END   AS asp\n*/\n      FROM PARTNER_PORTAL.dbt_adhingra.stg_dim_opportunity AS o\n        JOIN PARTNER_PORTAL.dbt_adhingra.stg_dim_partner_subsidiary AS p ON o.partner_id = p.id\n            WHERE o.country_code_iso3 = 'DEU' AND o.finished_date IS NOT NULL\n      GROUP BY 1, 2, 3\n  ),\nranked AS (\n      SELECT\n        fd.parent_id,\n        fd.id,\n        fd.date_year,\n        conversion_rate,\n        asp,\n        gross_process_duration,\n        row_number()\n        OVER (\n          PARTITION BY fd.date_year\n          ORDER BY conversion_rate DESC )                             AS rank_conversion_rate,\n        row_number()\n        OVER (\n          PARTITION BY fd.date_year\n          ORDER BY asp DESC )                                         AS rank_asp,\n        row_number()\n        OVER (\n          PARTITION BY fd.date_year\n          ORDER BY nullif(gross_process_duration, 0) ASC NULLS LAST ) AS rank_gross_process_duration\n      FROM fd_metrics fd\n        LEFT JOIN PARTNER_PORTAL.dbt_adhingra.deu_ocd_yearly ocd\n          ON fd.id = ocd.id AND fd.date_year = ocd.date_year\n      WHERE ocd.customer_potential >= 10\n  ), avg AS (\n      SELECT\n        date_year,\n        avg(case when rank_conversion_rate <= 20 then conversion_rate end) AS top20_conversion_rate,\n/*        avg(conversion_rate)\n          FILTER (WHERE rank_conversion_rate <= 20)        AS top20_conversion_rate, */\n        avg(conversion_rate) + 0.07                        AS market_avg_conversion_rate, -- Pad the market average as per P.C. by 7% for partner motivation\n        avg(case when rank_asp <=20 then asp end) as top20_asp,\n/*        avg(asp)\n          FILTER (WHERE rank_asp <= 20)                    AS top20_asp, \n          */\n        avg(asp) AS market_avg_asp,\n        avg(case when rank_gross_process_duration <= 20 then gross_process_duration end) as top20_gross_process_duration,\n/*        avg(gross_process_duration)\n          FILTER (WHERE rank_gross_process_duration <= 20) AS top20_gross_process_duration,\n          */\n        avg(nullif(gross_process_duration, 0))             AS market_avg_gross_process_duration\n      FROM ranked\n      GROUP BY date_year\n  ), top1 AS (\n      SELECT\n        date_year,\n        conversion_rate      AS top1_conversion_rate\n      FROM ranked\n      WHERE rank_conversion_rate = 1\n  )\n  SELECT DISTINCT\n    fd.parent_id,\n    fd.id,\n    fd.date_year,\n    fd.conversion_rate,\n    fd.asp,\n    fd.gross_process_duration,\n    a.market_avg_asp,\n    a.market_avg_conversion_rate,\n    a.market_avg_gross_process_duration,\n    a.top20_asp,\n    a.top20_conversion_rate,\n    a.top20_gross_process_duration,\n    r.rank_asp,\n    r.rank_conversion_rate,\n    r.rank_gross_process_duration,\n    t.top1_conversion_rate\n  FROM fd_metrics fd\n    LEFT JOIN ranked AS r ON fd.id = r.id AND fd.date_year = r.date_year\n    LEFT JOIN avg a ON a.date_year = fd.date_year\n    LEFT JOIN top1 t ON t.date_year = fd.date_year"}, "error": null, "status": null, "execution_time": 0.0542140007019043, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-10-11T11:00:07.843630Z", "completed_at": "2020-10-11T11:00:07.896950Z"}, {"name": "execute", "started_at": "2020-10-11T11:00:07.897392Z", "completed_at": "2020-10-11T11:00:07.897402Z"}], "fail": null, "warn": null, "skip": false}], "generated_at": "2020-10-11T11:00:07.924912Z", "elapsed_time": 2.8958237171173096}